module.exports=[93695,(e,t,a)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},14747,(e,t,a)=>{t.exports=e.x("path",()=>require("path"))},70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,a)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},22734,(e,t,a)=>{t.exports=e.x("fs",()=>require("fs"))},20840,e=>{"use strict";var t=e.i(22734),a=e.i(14747);let r=a.default.join(o(),"config","realestate_city_uf_region.v1.json"),n={BR:"Brasil",AC:"Norte",AP:"Norte",AM:"Norte",PA:"Norte",RO:"Norte",RR:"Norte",TO:"Norte",AL:"Nordeste",BA:"Nordeste",CE:"Nordeste",MA:"Nordeste",PB:"Nordeste",PE:"Nordeste",PI:"Nordeste",RN:"Nordeste",SE:"Nordeste",DF:"Centro-Oeste",GO:"Centro-Oeste",MS:"Centro-Oeste",MT:"Centro-Oeste",ES:"Sudeste",MG:"Sudeste",RJ:"Sudeste",SP:"Sudeste",PR:"Sul",RS:"Sul",SC:"Sul"},i={"indice fipezap":"BR",aracaju:"SE","balneario camboriu":"SC",barueri:"SP","sao paulo":"SP","rio de janeiro":"RJ","belo horizonte":"MG",brasilia:"DF","porto alegre":"RS",curitiba:"PR",florianopolis:"SC",salvador:"BA",recife:"PE",fortaleza:"CE",goiania:"GO","campo grande":"MS",cuiaba:"MT",manaus:"AM",belem:"PA",vitoria:"ES",betim:"MG",blumenau:"SC",campinas:"SP",canoas:"RS","caxias do sul":"RS",contagem:"MG",diadema:"SP",guaruja:"SP",guarulhos:"SP",itajai:"SC",itapema:"SC","jaboatao dos guararapes":"PE",joinville:"SC","joao pessoa":"PB",londrina:"PR",maceio:"AL",natal:"RN",niteroi:"RJ","novo hamburgo":"RS",osasco:"SP",pelotas:"RS","praia grande":"SP","ribeirao preto":"SP","santa maria":"RS",santos:"SP","santo andre":"SP","sao bernardo do campo":"SP","sao caetano do sul":"SP","sao jose dos campos":"SP","sao jose dos pinhais":"PR","sao jose do rio preto":"SP","sao jose":"SC","sao leopoldo":"RS","sao luis":"MA","sao vicente":"SP",teresina:"PI","vila velha":"ES"};function o(){return a.default.resolve(process.cwd(),"..")}function s(e){return Math.max(0,Math.min(1,e))}function l(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}function u(e){return l(e).replace(/[^a-z0-9_]/g,"_")}function d(e){if(!e)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;if(/^\d{4}-\d{2}$/.test(e))return`${e}-01`;let t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)}async function c(e){let a=(await t.promises.readFile(e,"utf-8")).split(/\r?\n/).filter(Boolean);return a.length<2?[]:a.slice(1).map(e=>e.split(",")).map(e=>({date:d((e[0]||"").trim()),value:Number((e[1]||"").trim())})).filter(e=>e.date&&Number.isFinite(e.value)).sort((e,t)=>e.date.localeCompare(t.date))}let p=null;async function m(){if(p)return p;try{let e=await t.promises.readFile(r,"utf-8"),a=JSON.parse(e);p=Array.isArray(a.entries)?a.entries:[]}catch{p=[]}return p}async function f(e){let t,a,r,o=(r=n[a=i[l(t=e.replace(/^FipeZap_/i,"").replace(/_Total$/i,"").replace(/_core$/i,"").replace(/_/g," "))]||"NA"]||"Desconhecida",{asset:e,city:t,state:a,region:r,source_type:"proxy",source_name:"fallback_mapping"}),s=await m();if(!s.length)return o;let u=l(o.city),d=s.find(t=>String(t.asset||"").toLowerCase()===e.toLowerCase()),c=s.find(e=>String(e.city_key||"").toLowerCase()===u),p=d||c;if(!p)return o;let f=String(p.uf||o.state||"NA"),g=String(p.region||n[f]||o.region||"Desconhecida");return{asset:e,city:String(p.city||o.city),state:f,region:g,source_type:String(p.source_type||"proxy"),source_name:String(p.source_name||"dictionary")}}function g(){return a.default.join(o(),"data","realestate","normalized")}function h(){return a.default.join(o(),"data","realestate","core")}async function v(e){for(let r of[a.default.join(o(),"results","validation","universe_mini",`RE_${u(e)}`,"summary.json"),a.default.join(o(),"results","validation","universe_mini_full",`RE_${u(e)}`,"summary.json")])try{let e=await t.promises.readFile(r,"utf-8"),a=JSON.parse(e),n=Number(a.m),i=Number(a.tau);if(Number.isFinite(n)&&Number.isFinite(i))return{m:n,tau:i}}catch{}return{m:4,tau:2}}async function y(e){let r=a.default.join(o(),"results","realestate","assets");for(let n of[`${e}_monthly_regimes.csv`,`${e.toUpperCase()}_monthly_regimes.csv`,`${u(e)}_monthly_regimes.csv`,`${u(e).toUpperCase()}_monthly_regimes.csv`]){let e=a.default.join(r,n);try{let a=await t.promises.readFile(e,"utf-8"),r=(function(e){let t=e.split(/\r?\n/).filter(Boolean);if(t.length<2)return[];let a=t[0].split(",").map(e=>e.trim().toLowerCase()),r=a.indexOf("date"),n=a.indexOf("regime"),i=a.indexOf("confidence");return r<0||n<0?[]:t.slice(1).map(e=>{let t=e.split(",");return{date:d((t[r]||"").trim()),regime:(t[n]||"").trim(),confidence:i>=0?Number((t[i]||"").trim()):NaN}})})(a).filter(e=>e.date&&e.regime);if(r.length)return r}catch{}}return[]}async function N(){let e=h();try{return(await t.promises.readdir(e)).filter(e=>e.endsWith("_core.csv")).map(e=>e.replace(/_core\.csv$/i,"")).sort()}catch{return[]}}async function x(){let e=g();try{return(await t.promises.readdir(e)).filter(e=>e.startsWith("FipeZap_")&&e.endsWith(".csv")).map(e=>e.replace(/\.csv$/i,"")).sort()}catch{return[]}}async function R(){let e=await N();return e.length?e:x()}async function _(){let e=await R();return(await Promise.all(e.map(e=>f(e)))).sort((e,t)=>{let a=e.region.localeCompare(t.region);if(0!==a)return a;let r=e.state.localeCompare(t.state);return 0!==r?r:e.city.localeCompare(t.city)})}async function b(e){let r=a.default.join(h(),`${e}_core.csv`);try{let e=(await t.promises.readFile(r,"utf-8")).split(/\r?\n/).filter(Boolean);if(e.length<2)return[];let a=e[0].split(",").map(e=>e.trim()),n=e=>a.findIndex(t=>t.toLowerCase()===e.toLowerCase()),i=n("date"),o=n("P"),s=n("L"),l=n("J"),u=n("D");if(i<0||o<0)return null;return e.slice(1).map(e=>{let t=e.split(","),a=u>=0?t[u]:"";return{date:(t[i]||"").trim(),P:Number((t[o]||"").trim()),L:s>=0?Number((t[s]||"").trim()):NaN,J:l>=0?Number((t[l]||"").trim()):NaN,D:null==a||""===a.trim()?null:Number(a.trim())}})}catch{return null}}async function S(e){var t;let r,n,i,o,l,u,p,m,[f,h]=await Promise.all([b(e),y(e)]);if(f&&f.length)r=function(e,t){let a=t.map(e=>({date:d(e.date),P:Number(e.P),L:Number(e.L),J:Number(e.J),D:null==e.D?NaN:Number(e.D)})).filter(e=>e.date&&Number.isFinite(e.P)).sort((e,t)=>e.date.localeCompare(t.date)),r=a.map(e=>e.date),n=r[0]||"",i=r[r.length-1]||"",o=n&&i?(new Date(i).getTime()-new Date(n).getTime())/315576e5:0,s=0;for(let e=1;e<a.length;e++){let t=new Date(a[e-1].date).getTime();Math.round((new Date(a[e].date).getTime()-t)/864e5)>35&&(s+=1)}let l=a.length>1?s/(a.length-1):1;return{asset:e,profile:{n_points:a.length,coverage_years:Number(o.toFixed(2)),gap_ratio:Number(l.toFixed(4)),start_date:n,end_date:i,required_fields:{P:a.length>0,L:a.some(e=>Number.isFinite(e.L)),J:a.some(e=>Number.isFinite(e.J)),D:a.some(e=>Number.isFinite(e.D))},notes:["P(t): preco medio do m2","L(t): proxy de liquidez","J(t): juros (Selic/financiamento)","D(t): desconto medio (quando disponivel)"]},series:{P:a.map(e=>({date:e.date,value:e.P})),L:a.filter(e=>Number.isFinite(e.L)).map(e=>({date:e.date,value:e.L})),J:a.filter(e=>Number.isFinite(e.J)).map(e=>({date:e.date,value:e.J})),D:a.filter(e=>Number.isFinite(e.D)).map(e=>({date:e.date,value:Number(e.D)}))}}}(e,f);else{let t=g(),n=a.default.join(g(),`${e}.csv`),i=a.default.join(t,"SELIC_D_11.csv"),[o,l]=await Promise.all([c(n),c(i)]);r=function(e,t,a){let r=new Map(a.map(e=>[e.date,e.value])),n=t.filter(e=>Number.isFinite(e.value)),i=n.map(e=>e.date),o=i[0]||"",l=i[i.length-1]||"",u=o&&l?(new Date(l).getTime()-new Date(o).getTime())/315576e5:0,d=n.map(e=>e.value),c=function(e,t){let a=[],r=0;for(let t=0;t<e.length;t++)r+=e[t],t>=3&&(r-=e[t-3]),a.push(r/Math.min(3,t+1));return a}(d.map((e,t)=>0===t?0:Math.log(Math.max(e,1e-9)/Math.max(d[t-1],1e-9))).map(e=>Math.abs(e)),0),p=Math.max(...c,1e-9),m=n.map((e,t)=>({date:e.date,value:s(1-c[t]/p)})),f=a.length?a[0].value:0,g=[...a].sort((e,t)=>e.date.localeCompare(t.date)),h=0,v=n.map(e=>{for(;h<g.length&&g[h].date<=e.date;)f=g[h].value,h+=1;let t=r.get(e.date);return{date:e.date,value:Number.isFinite(t)?t:f}}),y=0;for(let e=1;e<n.length;e++){let t=new Date(n[e-1].date).getTime();Math.round((new Date(n[e].date).getTime()-t)/864e5)>35&&(y+=1)}let N=n.length>1?y/(n.length-1):1;return{asset:e,profile:{n_points:n.length,coverage_years:Number(u.toFixed(2)),gap_ratio:Number(N.toFixed(4)),start_date:o,end_date:l,required_fields:{P:n.length>0,L:m.length>0,J:v.length>0,D:!1},notes:["L(t) usa proxy de liquidez via estabilidade local de retornos.","D(t) ainda nao existe no repositorio; TODO: integrar desconto pedido x fechamento."]},series:{P:n,L:m,J:v,D:[]}}}(e,o,l)}let N=await v(e),x=function(e,t,a){let r=[],n=0,i=null;for(let t=0;t<e.length;t++){let a=e[t],o=a.regime||"INCONCLUSIVE",l=Number.isFinite(a.confidence)?s(a.confidence):0;o===i?n+=1:n=1;let u=null!=i&&o!==i,d="UNSTABLE"===o?.8:"TRANSITION"===o?.55:"STABLE"===o?.2:.95;r.push({date:a.date,regime:o,microstate:"UNK",transition:u,confidence:Number(l.toFixed(4)),quality:0,entropy:0,persistence:n,instability_score:Number(d.toFixed(4))}),i=o}return{m:t,tau:a,rows:r}}(h,N.m,N.tau),R=(t=r,n=x.rows,i=t.profile.n_points>=200&&t.profile.coverage_years>=3&&t.profile.gap_ratio<=.12,o=n.length>0,l=function(e){if(!e.length)return e;let t=[e[0]],a=e[0],r=null,n=0;for(let i=1;i<e.length;i++){let o=e[i];if(o===a){r=null,n=0,t.push(a);continue}r===o?n+=1:(r=o,n=1),n>=3&&(a=o,r=null,n=0),t.push(a)}return t}(n.map(e=>{if(!i||!o)return"inconclusive";let t=e.quality>0?e.quality:e.confidence,a=e.confidence;return t>=.7&&a>=.6&&"STABLE"===e.regime?"validated":t>=.55&&a>=.45?"watch":"inconclusive"})),u=n.length?n[n.length-1]:null,p=l.length?l[l.length-1]:"inconclusive",m="Diagnostico inconclusivo.",i?o?"validated"===p?m="Regime estavel com confianca e qualidade acima do gate.":"watch"===p&&(m="Regime em observacao: sinais de transicao/instabilidade, manter postura defensiva."):m="Sem regime validado do motor (pipeline de regimes nao encontrado para este ativo).":m="Dados insuficientes para operacao: verifique n de pontos, cobertura temporal e lacunas.",{status:p,explanation:m,adequacy_ok:i,thresholds:{min_points:200,min_coverage_years:3,max_gap_ratio:.12,validated_confidence:.6,validated_quality:.7,watch_confidence:.45,watch_quality:.55,hysteresis_days:3},latest:u?{date:u.date,regime:u.regime,confidence:u.confidence,quality:u.quality,entropy:u.entropy,persistence:u.persistence,instability_score:u.instability_score}:null});return{data:r,dynamic:x,operational:R}}e.s(["buildRealEstateAssetPayload",()=>S,"listRealEstateAssetMeta",()=>_,"listRealEstateAssets",()=>R])},63099,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),n=e.i(59756),i=e.i(61916),o=e.i(74677),s=e.i(69741),l=e.i(16795),u=e.i(87718),d=e.i(95169),c=e.i(47587),p=e.i(66012),m=e.i(70101),f=e.i(26937),g=e.i(10372),h=e.i(93695);e.i(52474);var v=e.i(220),y=e.i(89171),N=e.i(20840);function x(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9_]/g,"_")}async function R(e){let{searchParams:t}=new URL(e.url),a=t.get("asset");try{let[e,t]=await Promise.all([(0,N.listRealEstateAssets)(),(0,N.listRealEstateAssetMeta)()]);if(!e.length)return y.NextResponse.json({error:"realestate_assets_not_found"},{status:404});let r=x(a||""),n=a&&e.find(e=>e===a)||e.find(e=>x(e)===r)||e[0],i=await (0,N.buildRealEstateAssetPayload)(n);return y.NextResponse.json({asset:n,assets:e,assets_meta:t,...i})}catch(e){return y.NextResponse.json({error:"realestate_asset_failed",reason:e instanceof Error?e.message:"unknown_error"},{status:500})}}e.s(["GET",()=>R],87847);var _=e.i(87847);let b=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/realestate/asset/route",pathname:"/api/realestate/asset",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/realestate/asset/route.ts",nextConfigOutput:"",userland:_}),{workAsyncStorage:S,workUnitAsyncStorage:w,serverHooks:P}=b;function C(){return(0,r.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:w})}async function E(e,t,r){b.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/realestate/asset/route";y=y.replace(/\/index$/,"")||"/";let N=await b.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!N)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:x,params:R,nextConfig:_,parsedUrl:S,isDraftMode:w,prerenderManifest:P,routerServerContext:C,isOnDemandRevalidate:E,revalidateOnlyGenerated:A,resolvedPathname:D,clientReferenceManifest:j,serverActionsManifest:T}=N,O=(0,s.normalizeAppPath)(y),F=!!(P.dynamicRoutes[O]||P.routes[D]),q=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,S,!1):t.end("This page could not be found"),null);if(F&&!w){let e=!!P.routes[D],t=P.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(_.experimental.adapterPath)return await q();throw new h.NoFallbackError}}let M=null;!F||b.isDev||w||(M="/index"===(M=D)?"/":M);let L=!0===b.isDev||!F,k=F&&!L;T&&j&&(0,o.setManifestsSingleton)({page:y,clientReferenceManifest:j,serverActionsManifest:T});let I=e.method||"GET",$=(0,i.getTracer)(),U=$.getActiveScopeSpan(),B={params:R,prerenderManifest:P,renderOpts:{experimental:{authInterrupts:!!_.experimental.authInterrupts},cacheComponents:!!_.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:_.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,n)=>b.onRequestError(e,t,r,n,C)},sharedContext:{buildId:x}},H=new l.NodeNextRequest(e),J=new l.NodeNextResponse(t),z=u.NextRequestAdapter.fromNodeNextRequest(H,(0,u.signalFromNodeResponse)(t));try{let o=async e=>b.handle(z,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=$.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${I} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${I} ${y}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var i,l;let u=async({previousCacheEntry:a})=>{try{if(!s&&E&&A&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let u=B.renderOpts.collectedTags;if(!F)return await (0,p.sendResponse)(H,J,i,B.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(i.headers);u&&(t[g.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,r=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:E})},!1,C),t}},d=await b.handleResponse({req:e,nextConfig:_,cacheKey:M,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:P,isRoutePPREnabled:!1,isOnDemandRevalidate:E,revalidateOnlyGenerated:A,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:s});if(!F)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",E?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),w&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&F||h.delete(g.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(H,J,new Response(d.value.body,{headers:h,status:d.value.status||200})),null};U?await l(U):await $.withPropagatedContext(e.headers,()=>$.trace(d.BaseServerSpan.handleRequest,{spanName:`${I} ${y}`,kind:i.SpanKind.SERVER,attributes:{"http.method":I,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:E})},!1,C),F)throw t;return await (0,p.sendResponse)(H,J,new Response(null,{status:500})),null}}e.s(["handler",()=>E,"patchFetch",()=>C,"routeModule",()=>b,"serverHooks",()=>P,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>w],63099)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5ff77f10._.js.map